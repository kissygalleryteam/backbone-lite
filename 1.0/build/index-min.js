/*!build time : 2013-09-26 11:33:19 AM*/
KISSY.add("gallery/backbone-lite/1.0/index",function(a,b,c){return function(){var d,e=this,f=e.Backbone,g=[],h=g.push,i=g.slice,j=g.splice;d="undefined"!=typeof exports?exports:e.Backbone={},d.VERSION="1.0.0";var k=function(a){return a instanceof k?a:this instanceof k?(this._wrapped=a,void 0):new k(a)},l=k.each=a.each;k.clone=a.clone,k.isFunction=a.isFunction,k.isArray=a.isArray,k.isString=a.isString,k.isEmpty=a.isEmptyObject,k.filter=a.filter,k.indexOf=function(b,c){return a.indexOf(c,b)},k.map=k.collect=Array.prototype.map,k.uniqueId=a.guid,k.extend=function(a){return l(i.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},k.functions=k.methods=function(a){var b=[];for(var c in a)k.isFunction(a[c])&&b.push(c);return b.sort()},k.mixin=function(a){k.each(k.functions(a),function(b){var c=k[b]=a[b];k.prototype[b]=function(){var a=[this._wrapped];return h.apply(a,arguments),result.call(this,c.apply(k,a))}})},k.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},k.has=function(a,b){return hasOwnProperty.call(a,b)},k.keys=Object.keys,k.result=function(a,b){if(null==a)return void 0;var c=a[b];return k.isFunction(c)?c.call(a):c},k.sortedIndex=function(a,b,c,d){c=null==c?k.identity:lookupIterator(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},k.defaults=function(a){return l(i.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},k.invoke=function(a,b){var c=i.call(arguments,2),d=k.isFunction(b);return k.map(a,function(a){return(d?b:a[b]).apply(a,c)})},k.pick=function(a){var b={},c=Array.prototype.concat.apply(Array.prototype,i.call(arguments,1));return l(c,function(c){c in a&&(b[c]=a[c])}),b};var m=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof k&&(a=a._wrapped),b instanceof k&&(b=b._wrapped);var e=toString.call(a);if(e!=toString.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(k.isFunction(g)&&g instanceof g&&k.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var i=0,j=!0;if("[object Array]"==e){if(i=a.length,j=i==b.length)for(;i--&&(j=m(a[i],b[i],c,d)););}else{for(var l in a)if(k.has(a,l)&&(i++,!(j=k.has(b,l)&&m(a[l],b[l],c,d))))break;if(j){for(l in b)if(k.has(b,l)&&!i--)break;j=!i}}return c.pop(),d.pop(),j};k.isEqual=function(a,b){return m(a,b,[],[])},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var n=/(.)^/,o={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},p=/\\|'|\r|\n|\t|\u2028|\u2029/g;k.template=function(a,b,c){var d;c=k.defaults({},c,k.templateSettings);var e=new RegExp([(c.escape||n).source,(c.interpolate||n).source,(c.evaluate||n).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(p,function(a){return"\\"+o[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,k);var i=function(a){return d.call(this,a,k)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},k.bind=function(a){return Function.prototype.bind.apply(a,i.call(arguments,1))},k.mixin(k),d.$=b.all||e.jQuery||e.Zepto||e.ender||e.$,d._=k,d.noConflict=function(){return e.Backbone=f,this},d.emulateHTTP=!1,d.emulateJSON=!1;var q=d.Events={on:function(a,b,c){if(!s(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!s(this,"once",a,[b,c])||!b)return this;var d=this,e=k.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,h,i,j,l;if(!this._events||!s(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:k.keys(this._events),h=0,i=g.length;i>h;h++)if(a=g[h],f=this._events[a]){if(this._events[a]=d=[],b||c)for(j=0,l=f.length;l>j;j++)e=f[j],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=i.call(arguments,1);if(!s(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&t(c,b),d&&t(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},r=/\s+/,s=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(r.test(c)){for(var f=c.split(r),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},t=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},u={listenTo:"on",listenToOnce:"once"};a.each(u,function(a,b){q[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=k.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),q.bind=q.on,q.unbind=q.off,k.extend(d,q);var v=d.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=k.uniqueId("c"),this.attributes={},k.extend(this,k.pick(b,w)),b.parse&&(d=this.parse(d,b)||{}),(c=k.result(this,"defaults"))&&(d=k.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},w=["url","urlRoot","collection"];k.extend(v.prototype,q,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return k.clone(this.attributes)},sync:function(){return d.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return k.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,h,i,j,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,h=c.silent,g=[],i=this._changing,this._changing=!0,i||(this._previousAttributes=k.clone(this.attributes),this.changed={}),l=this.attributes,j=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],k.isEqual(l[d],b)||g.push(d),k.isEqual(j[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!h){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(i)return this;if(!h)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,k.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,k.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!k.isEmpty(this.changed):k.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?k.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)k.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return k.clone(this._previousAttributes)},fetch:function(a){a=a?k.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),b.trigger("sync",b,d,a),void 0):!1},J(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,!(!d||c&&c.wait||this.set(d,c)))return!1;if(c=k.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=k.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var h=this,i=c.success;return c.success=function(a){h.attributes=g;var b=h.parse(a,c);return c.wait&&(b=k.extend(d||{},b)),k.isObject(b)&&!h.set(b,c)?!1:(i&&i(h,a,c),h.trigger("sync",h,a,c),void 0)},J(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?k.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;J(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=k.result(this,"urlRoot")||k.result(this.collection,"url")||I();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},k.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=k.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,k.extend(b||{},{validationError:c})),!1):!0}});var x=["keys","values","pairs","invert","pick","omit"];a.each(x,function(a){v.prototype[a]=function(){var b=i.call(arguments);return b.unshift(this.attributes),k[a].apply(k,b)}});var y=d.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,k.extend({silent:!0},b))},z={add:!0,remove:!0,merge:!0},A={add:!0,merge:!1,remove:!1};k.extend(y.prototype,q,{model:v,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return d.sync.apply(this,arguments)},add:function(a,b){return this.set(a,k.defaults(b||{},A))},remove:function(a,b){a=k.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=k.defaults(b||{},z),b.parse&&(a=this.parse(a,b)),k.isArray(a)||(a=a?[a]:[]);var c,d,e,f,g,i=b.at,l=this.comparator&&null==i&&b.sort!==!1,m=k.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;d>c;c++)(e=this._prepareModel(a[c],b))&&((f=this.get(e))?(b.remove&&(p[f.cid]=!0),b.merge&&(f.set(e.attributes,b),l&&!g&&f.hasChanged(m)&&(g=!0))):b.add&&(n.push(e),e.on("all",this._onModelEvent,this),this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e)));if(b.remove){for(c=0,d=this.length;d>c;++c)p[(e=this.models[c]).cid]||o.push(e);o.length&&this.remove(o,b)}if(n.length&&(l&&(g=!0),this.length+=n.length,null!=i?j.apply(this.models,[i,0].concat(n)):h.apply(this.models,n)),g&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;d>c;c++)(e=n[c]).trigger("add",e,this,b);return g&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,k.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,k.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,k.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return k.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),k.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(k.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=k.isFunction(b)?b:function(a){return a.get(b)};return k.sortedIndex(this.models,a,d,c)},pluck:function(a){return k.invoke(this.models,"get",a)},fetch:function(a){a=a?k.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},J(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?k.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof v)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var B=["each","map","isEmpty","indexOf","collect","filter"];a.each(B,function(a){y.prototype[a]=function(){var b=i.call(arguments);return b.unshift(this.models),k[a].apply(k,b)}});var C=["groupBy","countBy","sortBy"];a.each(C,function(a){y.prototype[a]=function(b,c){var d=k.isFunction(b)?b:function(a){return a.get(b)};return k[a](this.models,d,c)}});var D=d.View=function(a){this.cid=k.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},E=/^(\S+)\s*(.*)$/,F=["model","collection","el","id","attributes","className","tagName","events"];k.extend(D.prototype,q,{tagName:"div",$:function(a){return this.$el.one(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof d.$?a:d.$(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=k.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(k.isFunction(c)||(c=this[a[b]]),c){var d=b.match(E),e=d[1],f=d[2];c=k.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.delegate(e,f,c)}}return this},undelegateEvents:function(){return this.$el.undelegate(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=k.extend({},k.result(this,"options"),a)),k.extend(this,k.pick(a,F)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(k.result(this,"el"),!1);else{var a=k.extend({},k.result(this,"attributes"));this.id&&(a.id=k.result(this,"id")),this.className&&(a["class"]=k.result(this,"className"));var b=d.$("<"+k.result(this,"tagName")+">").attr(a);this.setElement(b,!1)}}}),d.sync=function(a,b,c){var e=G[a];k.defaults(c||(c={}),{emulateHTTP:d.emulateHTTP,emulateJSON:d.emulateJSON});var f={type:e,dataType:"json"};if(c.url||(f.url=k.result(b,"url")||I()),null!=c.data||!b||"create"!==a&&"update"!==a&&"patch"!==a||(f.contentType="application/json",f.data=JSON.stringify(c.attrs||b.toJSON(c))),c.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),c.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",c.emulateJSON&&(f.data._method=e);var g=c.beforeSend;c.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||c.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var h=c.xhr=d.ajax(k.extend(f,c));return b.trigger("request",b,h,c),h};var G={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};d.ajax=function(){var b=arguments[0];if(window.lib&&window.lib.mtop&&b.api){window.$||(window.$={}),$.ajax=a.IO;var e=lib.mtop.ajax({api:b.api,v:b.v,data:b.data||{}},b.success,b.error);return e}return c.apply(d.$,arguments)};var H=function(a,b){var c,d=this;c=a&&k.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},k.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&k.extend(c.prototype,a),c.__super__=d.prototype,c};v.extend=y.extend=D.extend=H;var I=function(){throw new Error('A "url" property or function must be specified')},J=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),this.Backbone},{requires:["node","ajax","event"]});